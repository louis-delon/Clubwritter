<div class="container">
  <h1><%= "#{@theme.name}" %></h1>
  <% if @theme.photo.present? %>
    <p><%= cl_image_tag @theme.photo, height: 300, width: 400, crop: :fill %></p>
  <% end %>

  <% if policy(@theme).edit? %>
    <%= link_to(edit_theme_path(@theme), class: "btn btn--secondary") do %>
    <%= fa_icon "edit" %>Edit
    <% end %>
  <% end %>
  <% if policy(@theme).destroy?%>
    <%= link_to(theme_path(@theme), method: :delete, data: { confirm: "Are you sure?" }, class: "btn btn--secondary") do %>
      <%= fa_icon "remove" %>Delete
    <% end %>
  <% end %>

  <h2><%= "Thème proposé par #{@theme.user.pseudo}"%></h2>
  <p><%= @theme.category.name %> </p>
  <br>
  <br>
  <!-- user can see all the posts for other users if deadline is past -->
  <% if policy(@theme).show? && policy_scope(Post) && @theme.deadline.past? %>
    <%= "Theme terminé depuis le #{@theme.deadline}" %>
    <% @posts.where(theme_id: @theme.id).each do |post| %>
      <div class="row">
        <h3><%= post.content %></h3>
        <p><%= post.user.pseudo %></p>
      </div>
    <% end %>
  <% else %>
      <!-- user can update the post if the post exists and theadline is not past -->
    <% if policy(@post).update? %>
      <div class="row">
        <h3><%= @post.content %></h3>
      </div>
      <p><%= "Il vous reste #{@number_of_days} jours pour finaliser votre texte" %></p>
      <%= link_to "Poursuivre votre article", edit_theme_post_path([@theme, @post]), class: "btn btn-primary" %>
      <%= link_to "Supprimer mon article", theme_post_path([@theme, @post]), method: :delete, data: { confirm: "Are you sure?" }, class: "btn btn-primary" %>
    <% else %>
    <!-- if post doesn't exist, user can write a post -->
     <p><%= "Il vous reste #{@number_of_days} jours pour proposer un texte sur ce theme" %></p>
     <%= link_to "Ecrire un article", new_theme_post_path([@theme, @post]), class: "btn btn-primary" %>
    <% end %>
  <% end %>
</div>



